<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>스파이를 찾아라! 독도편</title>
<style>
  body {
    margin: 0;
    padding: 0;
    text-align: center;
    background: url('images/beach_background.png') no-repeat center center/cover;
    font-family: 'Arial', sans-serif;
  }
  h1 {
    margin-top: 20px;
    color: #004b87;
    background-color: rgba(255,255,255,0.7);
    display: inline-block;
    padding: 10px 20px;
    border-radius: 20px;
  }
  #startBtn, #replayBtn {
    margin: 15px;
    padding: 15px 30px;
    font-size: 20px;
    background-color: #004b87;
    color: white;
    border: none;
    border-radius: 15px;
    cursor: pointer;
    transition: transform 0.2s;
  }
  #startBtn:hover, #replayBtn:hover {
    transform: scale(1.05);
  }
  .sea-lions {
    display: flex;
    justify-content: center;
    align-items: flex-end;
    height: 70vh;
    gap: 80px;
    margin-top: 30px;
  }
  .sea-lion {
    position: relative;
    cursor: pointer;
    transition: transform 0.3s;
  }
  .sea-lion:hover {
    transform: scale(1.05);
  }

  /* 흔들림 애니메이션 */
  @keyframes talking {
    0% { transform: translateY(0); }
    25% { transform: translateY(-5px); }
    50% { transform: translateY(0); }
    75% { transform: translateY(5px); }
    100% { transform: translateY(0); }
  }

  /* 머리 위 음표 표시 */
  .note {
    position: absolute;
    top: -100px;
    left: 50%;
    transform: translateX(-50%) scale(0);
    font-size: 30px;
    color: #ffdd57;
    opacity: 0;
    transition: transform 0.3s, opacity 0.3s;
  }
  .note.show {
    transform: translateX(-50%) scale(1.2);
    opacity: 1;
    animation: pop 0.3s forwards;
  }
  @keyframes pop {
    0% { transform: translateX(-50%) scale(0); opacity: 0; }
    50% { transform: translateX(-50%) scale(1.3); opacity: 1; }
    100% { transform: translateX(-50%) scale(1); opacity: 1; }
  }

  /* 커스텀 팝업: 각 sea-lion 내부에서 중앙 정렬, 머리 위로 표시 */
  .popup {
    position: absolute;
    left: 50%;   /* 추가: 가운데 정렬 기준 */
    top: 0;      /* 추가: seal의 top을 기준으로 머리 위로 이동하도록 함 */
    transform: translate(-50%, -100%) scale(0);
    transition: transform 0.4s ease;
    pointer-events: none;
  }
  .popup.show {
    transform: translate(-50%, -120%) scale(1); /* 머리 위에서 조금 더 위로(얼굴 안 가리기) */
  }
</style>
</head>

<body>
  <h1>🦭 스파이를 찾아라! 독도편</h1>

  <button id="startBtn">게임 시작</button>
  <button id="replayBtn" style="display:none;">전체 다시 듣기 🔁</button>

  <div class="sea-lions">
    <!-- 바다사자 1 -->
    <div class="sea-lion" id="seal1">
      <div class="note" id="note1">♪</div>
      <img src="images/seal1.png" width="250">
      <img class="popup" id="fail1" src="images/fail.png" width="200" alt="fail1">
    </div>

    <!-- 바다사자 2 -->
    <div class="sea-lion" id="seal2">
      <div class="note" id="note2">♪</div>
      <img src="images/seal2.png" width="250">
      <img class="popup" id="success" src="images/correct.png" width="200" alt="success">
    </div>

    <!-- 바다사자 3 -->
    <div class="sea-lion" id="seal3">
      <div class="note" id="note3">♪</div>
      <img src="images/seal3.png" width="250">
      <img class="popup" id="fail3" src="images/fail.png" width="200" alt="fail3">
    </div>
  </div>

  <!-- 소리 -->
  <audio id="voice1" src="sounds/dokdo1.mp3"></audio>
  <audio id="voice2" src="sounds/takeshima.mp3"></audio>
  <audio id="voice3" src="sounds/dokdo2.mp3"></audio>

  <audio id="successSound" src="sounds/success.mp3"></audio>
  <audio id="failSound" src="sounds/fail.mp3"></audio>
  <audio id="backgroundMusic" src="sounds/background.mp3" loop></audio>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const backgroundMusic = document.getElementById("backgroundMusic");
      backgroundMusic.volume = 0.12; // 그대로 유지

      function showTalking(sealNum) {
        const seal = document.getElementById(`seal${sealNum}`);
        const voice = document.getElementById(`voice${sealNum}`);
        const note = document.getElementById(`note${sealNum}`);

        seal.style.animation = "talking 0.6s infinite";

        // 음표 1초 늦게 나타나게 하고, 충분히 유지되도록 제거시간 늘림
        setTimeout(() => note.classList.add("show"), 1000);

        voice.currentTime = 0;
        voice.play();

        // 음표 제거는 1초 후(=표시된 뒤 1초 유지). (기존에는 동시에 추가/제거되는 버그가 있었습니다)
        setTimeout(() => {
          note.classList.remove("show");
          seal.style.animation = "";
        }, 2000);
      }

      function playSequence() {
        setTimeout(() => showTalking(1), 500);
        setTimeout(() => showTalking(2), 2000);
        setTimeout(() => showTalking(3), 3500);
      }

      function startGame() {
        // 배경음악은 사용자의 클릭(버튼) 시 재생 -> 브라우저 자동재생 정책 회피
        backgroundMusic.currentTime = 0;
        backgroundMusic.play().catch(()=>{}); // 안전하게 시도

        document.getElementById('startBtn').style.display = 'none';
        document.getElementById('replayBtn').style.display = 'inline-block';
        playSequence();
      }

      document.getElementById('startBtn').onclick = startGame;
      document.getElementById('replayBtn').onclick = playSequence;

      // 성공/실패 클릭 이벤트 (팝업은 각 seal 내부에 있으므로 위치는 항상 머리 위 중앙)
      document.getElementById("seal2").onclick = function() {
        this.querySelector("img").src = "images/spy_seal2.png";
        const popup = document.getElementById("success");
        popup.classList.add("show");
        document.getElementById("successSound").currentTime = 0;
        document.getElementById("successSound").play();
        setTimeout(() => popup.classList.remove("show"), 3000);
      };

      document.getElementById("seal1").onclick = function() {
        const popup = document.getElementById("fail1");
        popup.classList.add("show");
        document.getElementById("failSound").currentTime = 0;
        document.getElementById("failSound").play();
        setTimeout(() => popup.classList.remove("show"), 3000);
      };

      document.getElementById("seal3").onclick = function() {
        const popup = document.getElementById("fail3");
        popup.classList.add("show");
        document.getElementById("failSound").currentTime = 0;
        document.getElementById("failSound").play();
        setTimeout(() => popup.classList.remove("show"), 3000);
      };
    });
  </script>
</body>
</html>



